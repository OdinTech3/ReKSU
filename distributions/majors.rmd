---
title: "Distribution of Majors"
output: github_document
---

```{r setup, include=F}
knitr::opts_chunk$set(
  fig.path = "markdown_figs/data_preparation-"
)
```

```{r}
library(dplyr)
library(magrittr)
library(tidyr)
```

## Load The Dataset

```{r}
cob_rt <- read.csv("data/COB_RT_Data.csv", na.strings = c("", "XX"))
```

## Filter Students by August 2011

```{r}
term_2011_df <- cob_rt %>% filter(TERM == 201180)
```

## Distribution of Majors in `F1_SEQ1`

### Recode `NA`s as `UNDECLARED`

```{r recode_na}
recode_na <- function(df, ..., replacement = c("UNDECLARED")){
  # capture expressions and create quosures
  dots <- enquos(...)
  col_names <- as.character(dots) %>% gsub("~", "", .)

  if (length(replacement) > 1) {
    replacement_list <- replacement
  } else {
    replacement_list <- rep(replacement, ...length())
  }

  replacement_list <- replacement_list %>%
      as.list() %>%
      set_names(col_names)


  df %>%
   select(...) %>%
    mutate_all(as.character) %>%
    replace_na(replacement_list) %>%
    mutate_all(as.factor)
}
```

```{r}
f1_seq1_df <-term_2011_df %>%
  recode_na(F1SEQ1_MAJOR)

summary(f1_seq1_df)
```

### Computing Probababilites for each Major in `F1_SEQ1`

```{r find-probabilities}
f1seq1_major_probs <- f1_seq1_df %>%
  select(F1SEQ1_MAJOR) %>%
  group_by(F1SEQ1_MAJOR) %>%
  summarise(freq = n()) %>%
  mutate(P = freq/sum(freq)) %>%
  arrange(desc(P))

head(f1seq1_major_probs)
```

```{r save-probabilities, eval=F, include=F}
f1seq1_major_probs %>%
  select(F1SEQ1_MAJOR, P) %>%
  write.csv(file = "data/f1seq1_major_probs_2011.csv", row.names = F)
```

## Distribution of Majors from `F1SEQ1` to `F1SEQ2`

### Recode `NA`s as `UNDECLARED`

```{r}
f1_seq1_2_df <-term_2011_df %>%
  recode_na(F1SEQ1_MAJOR, F1SEQ2_MAJOR)

summary(f1_seq1_2_df)
```

### Computing Conditional Probability

$$P(F1SEQ2_{MAJOR} | F1SEQ1_{MAJOR})$$
```{r compute_probs}
compute_probs <- function(df, ...) {
  # capture expressions and create quosures
  dots <- enquos(...)
  condition <- as.character(dots) %>% gsub("~", "", .) %>% magrittr::extract(1)

  df %>%
    # Joint Probability of $P(F1SEQ1_MAJOR, F1SEQ2_MAJOR)$
    group_by(...) %>%
    summarize(freq = n()) %>%
    ungroup() %>%
    mutate(jProb = freq / sum(freq)) %>%
    # Marginal Probability of  $P(F1SEQ1_MAJOR)$
    group_by_at(vars(condition)) %>%
    mutate(mProb = sum(jProb)) %>%
    mutate(cProb = jProb/mProb)
}
```

```{r find-probabilities}
f1_seq1_2_cprob <- f1_seq1_2_df %>%
  compute_probs(F1SEQ1_MAJOR, F1SEQ2_MAJOR)

head(f1_seq1_2_cprob)
```

```{r save-probabilities, eval=F, include=F}
f1_seq1_2_cprob %>%
  select(F1SEQ1_MAJOR, F1SEQ2_MAJOR, cProb) %>%
  write.csv(file = "data/f1seq1_2_major_cprobs_2011.csv", row.names = F)
```

## Distribution of Majors from `F1SEQ2` to `S1SEQ2`

### Recode `NA`s as `UNDECLARED`

```{r}
f1_s1_seq2_df <-term_2011_df %>%
  recode_na(F1SEQ2_MAJOR, S1SEQ2_MAJOR)

summary(f1_s1_seq2_df)
```

### Computing Conditional Probability

$$P(S1SEQ2_{MAJOR} | F1SEQ2_{MAJOR})$$
```{r compute_probs}
compute_probs <- function(df, ...) {
  # capture expressions and create quosures
  dots <- enquos(...)
  condition <- as.character(dots) %>% gsub("~", "", .) %>% magrittr::extract(1)

  df %>%
    # Joint Probability of $P(F1SEQ1_MAJOR, F1SEQ2_MAJOR)$
    group_by(...) %>%
    summarize(freq = n()) %>%
    ungroup() %>%
    mutate(jProb = freq / sum(freq)) %>%
    # Marginal Probability of  $P(F1SEQ1_MAJOR)$
    group_by_at(vars(condition)) %>%
    mutate(mProb = sum(jProb)) %>%
    mutate(cProb = jProb/mProb)
}
```

```{r find-probabilities}
f1_s1_seq2_cprob <- f1_s1_seq2_df %>%
  compute_probs(F1SEQ2_MAJOR, S1SEQ2_MAJOR)

head(f1_s1_seq2_cprob)
```

```{r save-probabilities, eval=F, include=F}
f1_s1_seq2_cprob %>%
  select(F1SEQ2_MAJOR, S1SEQ2_MAJOR, cProb) %>%
  write.csv(file = "data/f1_s1_seq2_major_cprobs_2011.csv", row.names = F)
```

## Distribution of Majors from `S1SEQ2` to `F2SEQ2`

### Recode `NA`s as `UNDECLARED`

```{r}
s1_f2_seq2_df <-term_2011_df %>%
  recode_na(S1SEQ2_MAJOR, F2SEQ2_MAJOR)

summary(s1_f2_seq2_df)
```

### Computing Conditional Probability

$$P(F2SEQ2_{MAJOR} | S1SEQ2_{MAJOR})$$

```{r find-probabilities}
s1_f2_seq2_cprob <- s1_f2_seq2_df %>%
  compute_probs(S1SEQ2_MAJOR, F2SEQ2_MAJOR)

head(s1_f2_seq2_cprob)
```

```{r save-probabilities, eval=F, include=F}
s1_f2_seq2_cprob %>%
  select(S1SEQ2_MAJOR, F2SEQ2_MAJOR, cProb) %>%
  write.csv(file = "data/s1_f2_seq2_major_cprobs_2011.csv", row.names = F)
```

## Distribution of Majors from `F2SEQ2` to `S2SEQ2`

### Recode `NA`s as `UNDECLARED`

```{r}
f2_s2_seq2_df <-term_2011_df %>%
  recode_na(F2SEQ2_MAJOR, S2SEQ2_MAJOR)

summary(f2_s2_seq2_df)
```

### Computing Conditional Probability

$$P(S2SEQ2_{MAJOR} | F2SEQ2_{MAJOR})$$

```{r find-probabilities}
f2_s2_seq2_cprob <- f2_s2_seq2_df %>%
  compute_probs(F2SEQ2_MAJOR, S2SEQ2_MAJOR)

head(f2_s2_seq2_cprob)
```

```{r save-probabilities, eval=F, include=F}
f2_s2_seq2_cprob %>%
  select(F2SEQ2_MAJOR, S2SEQ2_MAJOR, cProb) %>%
  write.csv(file = "data/f2_s2_seq2_major_cprobs_2011.csv", row.names = F)
```
